<script lang="ts" type="module">
  import { Type, Input, IconMinus, SelectMenu } from "figma-plugin-ds-svelte";
  import { LayerMod, layerProperties, LayerProperty, LayerPropertyOption } from "types";
  import IconButton from "./IconButton.svelte";

  export let layerMod: LayerMod;
  export let matchedNodeCount: number;
  export let onChange: (mod: LayerMod) => void;
  export let onSelectDelete: () => void;

  let selectedLayerProperty: LayerProperty | undefined = undefined;
  $: {
    selectedLayerProperty = layerMod.property;
  }

  let layerPropertyOptions: LayerPropertyOption[] = [];
  $: {
    const options = layerProperties.map((o) => {
      return { value: o, label: o, group: null, selected: o === selectedLayerProperty };
    });
    layerPropertyOptions = [
      {
        value: undefined,
        label: "Select property",
        group: null,
        selected: selectedLayerProperty === undefined,
      },
      ...options,
    ];
  }
</script>

<div class="flex flex-row space-x-2">
  <div class="flex flex-1 flex-col gap-1">
    <div class="flex flex-row items-center">
      <div class="flex flex-shrink-0 w-[32]">
        <Type>For</Type>
      </div>
      <div class="flex flex-1 relative">
        <Input
          class="flex flex-1"
          placeholder="Layers matching..."
          bind:value={layerMod.query}
          on:input={(e) => {
            layerMod.query = e.target["value"];
            onChange(layerMod);
          }}
        />
        <div class="flex flex-1 absolute h-full right-2">
          <div class="flex self-center opacity-40">
            <Type>{matchedNodeCount} {matchedNodeCount === 1 ? "match" : "matches"}</Type>
          </div>
        </div>
      </div>
    </div>
    <div class="flex flex-row items-center">
      <div class="flex flex-shrink-0 w-[32]">
        <Type>Set</Type>
      </div>
      <div class="flex flex-1 flex-row items-center gap-2 relative">
        <div class="grow relative">
          <SelectMenu
            bind:menuItems={layerPropertyOptions}
            on:change={(e) => {
              layerMod.property = e.detail.value;
              onChange(layerMod);
            }}
          />
        </div>
        <Type>to</Type>
        <Input
          class="w-[80]"
          placeholder="Value"
          bind:value={layerMod.value}
          on:input={(e) => {
            layerMod.value = e.target["value"];
            onChange(layerMod);
          }}
        />
      </div>
    </div>
  </div>
  <IconButton iconName={IconMinus} onClick={onSelectDelete} />
</div>
